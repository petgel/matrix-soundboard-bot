{"version":3,"file":"statsReportGatherer.js","names":["_connectionStats","require","_connectionStatsReporter","_transportStatsReporter","_mediaSsrcHandler","_mediaTrackHandler","_mediaTrackStatsHandler","_trackStatsReporter","_statsReportBuilder","_statsValueFormatter","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","StatsReportGatherer","constructor","callId","remoteUserId","pc","emitter","isFocus","ConnectionStats","addEventListener","onSignalStateChange","bind","trackStats","MediaTrackStatsHandler","MediaSsrcHandler","MediaTrackHandler","processStats","groupCallId","localUserId","summary","receivedMedia","receivedAudioMedia","receivedVideoMedia","audioTrackSummary","count","muted","videoTrackSummary","isActive","statsPromise","getStats","then","report","_this$connectionStats","_this$connectionStats2","currentStatsReport","result","processStatsReport","error","previousStatsReport","connectionStats","bitrate","download","audio","video","trackSummary","TrackStatsReporter","buildTrackSummary","Array","from","getTrack2stats","values","catch","handleError","Promise","resolve","_this$currentStatsRep","byteSentStats","Map","now","before","get","id","type","nominated","state","bandwidth","ConnectionStatsReporter","buildBandwidthReport","transport","TransportStatsReporter","buildReport","findTrack2Stats","buildPacketsLost","buildFramerateResolution","buildBitrateReceived","ts","findTransceiverByTrackId","trackId","setTrackStatsState","buildJitter","set","StatsValueFormatter","getNonNegativeValue","bytesSent","buildBitrateSend","buildCodec","kind","remoteSource","findLocalVideoTrackStats","calculateSimulcastFramerate","mediaTrackHandler","getActiveSimulcastStreams","emitByteSendReport","processAndEmitReport","setActive","getActive","_","StatsReportBuilder","build","packetLoss","emitConnectionStatsReport","stopProcessingStats","signalingState","currentRemoteDescription","mediaSsrcHandler","parse","sdp","currentLocalDescription","exports"],"sources":["../../../src/webrtc/stats/statsReportGatherer.ts"],"sourcesContent":["/*\nCopyright 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { ConnectionStats } from \"./connectionStats\";\nimport { StatsReportEmitter } from \"./statsReportEmitter\";\nimport { ByteSend, ByteSentStatsReport, TrackID } from \"./statsReport\";\nimport { ConnectionStatsReporter } from \"./connectionStatsReporter\";\nimport { TransportStatsReporter } from \"./transportStatsReporter\";\nimport { MediaSsrcHandler } from \"./media/mediaSsrcHandler\";\nimport { MediaTrackHandler } from \"./media/mediaTrackHandler\";\nimport { MediaTrackStatsHandler } from \"./media/mediaTrackStatsHandler\";\nimport { TrackStatsReporter } from \"./trackStatsReporter\";\nimport { StatsReportBuilder } from \"./statsReportBuilder\";\nimport { StatsValueFormatter } from \"./statsValueFormatter\";\nimport { SummaryStats } from \"./summaryStats\";\n\nexport class StatsReportGatherer {\n    private isActive = true;\n    private previousStatsReport: RTCStatsReport | undefined;\n    private currentStatsReport: RTCStatsReport | undefined;\n    private readonly connectionStats = new ConnectionStats();\n\n    private readonly trackStats: MediaTrackStatsHandler;\n\n    // private readonly ssrcToMid = { local: new Map<Mid, Ssrc[]>(), remote: new Map<Mid, Ssrc[]>() };\n\n    public constructor(\n        public readonly callId: string,\n        public readonly remoteUserId: string,\n        private readonly pc: RTCPeerConnection,\n        private readonly emitter: StatsReportEmitter,\n        private readonly isFocus = true,\n    ) {\n        pc.addEventListener(\"signalingstatechange\", this.onSignalStateChange.bind(this));\n        this.trackStats = new MediaTrackStatsHandler(new MediaSsrcHandler(), new MediaTrackHandler(pc));\n    }\n\n    public async processStats(groupCallId: string, localUserId: string): Promise<SummaryStats> {\n        const summary = {\n            receivedMedia: 0,\n            receivedAudioMedia: 0,\n            receivedVideoMedia: 0,\n            audioTrackSummary: { count: 0, muted: 0 },\n            videoTrackSummary: { count: 0, muted: 0 },\n        } as SummaryStats;\n        if (this.isActive) {\n            const statsPromise = this.pc.getStats();\n            if (typeof statsPromise?.then === \"function\") {\n                return statsPromise\n                    .then((report) => {\n                        // @ts-ignore\n                        this.currentStatsReport = typeof report?.result === \"function\" ? report.result() : report;\n                        try {\n                            this.processStatsReport(groupCallId, localUserId);\n                        } catch (error) {\n                            this.isActive = false;\n                            return summary;\n                        }\n\n                        this.previousStatsReport = this.currentStatsReport;\n                        summary.receivedMedia = this.connectionStats.bitrate.download;\n                        summary.receivedAudioMedia = this.connectionStats.bitrate.audio?.download || 0;\n                        summary.receivedVideoMedia = this.connectionStats.bitrate.video?.download || 0;\n                        const trackSummary = TrackStatsReporter.buildTrackSummary(\n                            Array.from(this.trackStats.getTrack2stats().values()),\n                        );\n                        return {\n                            ...summary,\n                            audioTrackSummary: trackSummary.audioTrackSummary,\n                            videoTrackSummary: trackSummary.videoTrackSummary,\n                        };\n                    })\n                    .catch((error) => {\n                        this.handleError(error);\n                        return summary;\n                    });\n            }\n            this.isActive = false;\n        }\n        return Promise.resolve(summary);\n    }\n\n    private processStatsReport(groupCallId: string, localUserId: string): void {\n        const byteSentStats: ByteSentStatsReport = new Map<TrackID, ByteSend>();\n\n        this.currentStatsReport?.forEach((now) => {\n            const before = this.previousStatsReport ? this.previousStatsReport.get(now.id) : null;\n            // RTCIceCandidatePairStats - https://w3c.github.io/webrtc-stats/#candidatepair-dict*\n            if (now.type === \"candidate-pair\" && now.nominated && now.state === \"succeeded\") {\n                this.connectionStats.bandwidth = ConnectionStatsReporter.buildBandwidthReport(now);\n                this.connectionStats.transport = TransportStatsReporter.buildReport(\n                    this.currentStatsReport,\n                    now,\n                    this.connectionStats.transport,\n                    this.isFocus,\n                );\n\n                // RTCReceivedRtpStreamStats\n                // https://w3c.github.io/webrtc-stats/#receivedrtpstats-dict*\n                // RTCSentRtpStreamStats\n                // https://w3c.github.io/webrtc-stats/#sentrtpstats-dict*\n            } else if (now.type === \"inbound-rtp\" || now.type === \"outbound-rtp\") {\n                const trackStats = this.trackStats.findTrack2Stats(\n                    now,\n                    now.type === \"inbound-rtp\" ? \"remote\" : \"local\",\n                );\n                if (!trackStats) {\n                    return;\n                }\n\n                if (before) {\n                    TrackStatsReporter.buildPacketsLost(trackStats, now, before);\n                }\n\n                // Get the resolution and framerate for only remote video sources here. For the local video sources,\n                // 'track' stats will be used since they have the updated resolution based on the simulcast streams\n                // currently being sent. Promise based getStats reports three 'outbound-rtp' streams and there will be\n                // more calculations needed to determine what is the highest resolution stream sent by the client if the\n                // 'outbound-rtp' stats are used.\n                if (now.type === \"inbound-rtp\") {\n                    TrackStatsReporter.buildFramerateResolution(trackStats, now);\n                    if (before) {\n                        TrackStatsReporter.buildBitrateReceived(trackStats, now, before);\n                    }\n                    const ts = this.trackStats.findTransceiverByTrackId(trackStats.trackId);\n                    TrackStatsReporter.setTrackStatsState(trackStats, ts);\n                    TrackStatsReporter.buildJitter(trackStats, now);\n                } else if (before) {\n                    byteSentStats.set(trackStats.trackId, StatsValueFormatter.getNonNegativeValue(now.bytesSent));\n                    TrackStatsReporter.buildBitrateSend(trackStats, now, before);\n                }\n                TrackStatsReporter.buildCodec(this.currentStatsReport, trackStats, now);\n            } else if (now.type === \"track\" && now.kind === \"video\" && !now.remoteSource) {\n                const trackStats = this.trackStats.findLocalVideoTrackStats(now);\n                if (!trackStats) {\n                    return;\n                }\n                TrackStatsReporter.buildFramerateResolution(trackStats, now);\n                TrackStatsReporter.calculateSimulcastFramerate(\n                    trackStats,\n                    now,\n                    before,\n                    this.trackStats.mediaTrackHandler.getActiveSimulcastStreams(),\n                );\n            }\n        });\n\n        this.emitter.emitByteSendReport(byteSentStats);\n        this.processAndEmitReport();\n    }\n\n    public setActive(isActive: boolean): void {\n        this.isActive = isActive;\n    }\n\n    public getActive(): boolean {\n        return this.isActive;\n    }\n\n    private handleError(_: any): void {\n        this.isActive = false;\n    }\n\n    private processAndEmitReport(): void {\n        const report = StatsReportBuilder.build(this.trackStats.getTrack2stats());\n\n        this.connectionStats.bandwidth = report.bandwidth;\n        this.connectionStats.bitrate = report.bitrate;\n        this.connectionStats.packetLoss = report.packetLoss;\n\n        this.emitter.emitConnectionStatsReport({\n            ...report,\n            transport: this.connectionStats.transport,\n        });\n\n        this.connectionStats.transport = [];\n    }\n\n    public stopProcessingStats(): void {}\n\n    private onSignalStateChange(): void {\n        if (this.pc.signalingState === \"stable\") {\n            if (this.pc.currentRemoteDescription) {\n                this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp, \"remote\");\n            }\n            if (this.pc.currentLocalDescription) {\n                this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp, \"local\");\n            }\n        }\n    }\n}\n"],"mappings":"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"}